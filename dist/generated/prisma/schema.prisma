// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

// Also generate client to node_modules for production runtime
generator client_node {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

// User model for authentication
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  sessions Session[]
  posts    Post[]
  comments Comment[]

  @@map("users")
}

// Session model for user sessions
model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

// Post model for user posts/content
model Post {
  id        String   @id @default(cuid())
  title     String
  content   String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  comments Comment[]

  @@index([userId])
  @@map("posts")
}

// Comment model for post comments
model Comment {
  id        String   @id @default(cuid())
  content   String
  userId    String
  postId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([postId])
  @@map("comments")
}

// Audit Log model for tracking changes
model AuditLog {
  id        String   @id @default(cuid())
  action    String
  entity    String
  entityId  String
  changes   Json?
  createdAt DateTime @default(now())

  @@index([entity])
  @@index([entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

// Proposição model - Parliamentary proposals from Câmara dos Deputados
model Proposicao {
  // Primary ID
  id Int @id

  // Basic Info
  uri           String @unique
  siglaTipo     String
  numero        Int
  ano           Int
  codTipo       Int
  descricaoTipo String

  // Description
  ementa          String
  ementaDetalhada String?
  keywords        String?

  // Dates and Links
  dataApresentacao  DateTime?
  uriOrgaoNumerador String?
  urlInteiroTeor    String?

  // References to other propositions
  uriPropAnterior  String?
  uriPropPrincipal String?
  uriPropPosterior String?

  // Status fields (flattened from ultimoStatus)
  statusData          DateTime?
  statusSequencia     String?
  uriRelator          String?
  codOrgao            String?
  siglaOrgao          String?
  uriOrgao            String?
  regime              String?
  descricaoTramitacao String?
  idTipoTramitacao    String?
  descricaoSituacao   String?
  idSituacao          String?
  despacho            String?
  statusApreciacao    String?
  statusUrl           String?

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([ano])
  @@index([siglaTipo])
  @@index([numero])
  @@index([statusData])
  @@index([descricaoSituacao])
  @@map("proposicoes")
}
